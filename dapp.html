<!DOCTYPE html>
<html>
<head>
	<title>Session 4. dApp 실습 가이드</title>
	<meta charset="utf-8">
	<link href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css" rel="stylesheet">
	<link href="css/Styles.css" rel="stylesheet">
</head>
<body>
	<h1 id="main_title" align="center">Session 4. dApp 실습 가이드</h1>

<!--Step 1-->
	<div class="steps">
		<h3 class="sub_title">Step 1. 실습환경 준비</h3>
		<div class="content">
			<ol>
				
				<li>Geth Private network 접속</li>
				<p>콘솔에 아래와 같이 입력하여 Private network에 접속하세요.</p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
				<tr>
				<td>
					<p><code>$ geth --datadir "./ether_study" --networkid 15    --port 8080 --rpc --rpccorsdomain "*" --rpcapi "admin,db,eth,miner,net,txpool,personal,web3" console
					</code></p>
				</td>
				</tr>
				</table>
				<p>프롬프트가 깜빡이는지 확인하세요.</p>
				<img src="img/geth_run.png" width="800px" border="1px">
				<br><br>
				<li>CLI를 이용해 Bootnode에 직접 접속하기</li>
				<p>콘솔에 아래와 같이 입력하여 Bootnode에 직접 접속하세요. </p><br>
				<img src="img/bootnode.png"><br><br>
				<p><b>Bootnode 1</b><font color="=#000000" style="font-size: 12pt"> 좌석번호 1번 ~ 8번까지 1번 Bootnode에 접속해주세요.</font></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>admin.addPeer("enode://050e541ba9321debf17e0e020caef78e0dfb20852f85b88cf2019885f50ace72d1f4eb650f73173df8556949e7e7c60a703fa32993c6cbdbef683a079f00b8f3@13.124.226.8:8080")</code></p>
						</td>
					</tr>
				</table><br>
				<p><b>Bootnode 2</b><font color="=#000000" style="font-size: 12pt"> 좌석번호 9번 ~ 16번까지 2번 Bootnode에 접속해주세요.</font></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>admin.addPeer("enode://9d2b72b673b8daf33d3132aaa12e18b42cfa21d4f4fee9f9c3eb7775ce9b0726e9c60b1af57b0d90ae03914ca3803d43dbef2ec7683a2f38f63363bdb686a84b@13.125.35.226:8080")</code></p>
						</td>
					</tr>
				</table><br>
				<p><b>Bootnode 3</b><font color="=#000000" style="font-size: 12pt"> 좌석번호 17번 ~ 24번까지 3번 Bootnode에 접속해주세요.</font></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>admin.addPeer("enode://94f9e6aa37d48560fdf4b8f6144cd9c11e3f33009462356215226778112f37e253a55c10d7e3703a639a0f130331c12e740c36d202139243e9181c0adca7c2a1@52.78.81.206:8080")</code></p>
						</td>
					</tr>
				</table><br>
				<p><b>Bootnode 4</b><font color="=#000000" style="font-size: 12pt"> 좌석번호 25번 ~ 32번까지 4번 Bootnode에 접속해주세요.</font></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>admin.addPeer("enode://3387f881cfc46624928642bad2de1ca79e9d624e59717ffab1be362576daedbb9820e438fac5ed6b21dbefed7c03f5a41b0c28970fb93b7951def04e2424dc11@13.124.217.65:8080")</code></p>
						</td>
					</tr>
				</table><br>
				<p><b>Bootnode 5</b><font color="=#000000" style="font-size: 12pt"> 좌석번호 33번 ~ 40번까지 5번 Bootnode에 접속해주세요.</font></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>admin.addPeer("enode://af6af1fbd314a6bdc2920f623a555bff33099f4f6c9213858a63913c5cd0a5576e16a27bfd1220bddb7325071b0b2b4cdac8a7c5288b405035a1595d80c905ed@13.125.25.243:8080")</code></p>
						</td>
					</tr>
				</table><br>
				<p>[TIP] --datadir 디렉토리에 static-nodes.json 파일에 부트노드 저장시 항상 접속됨  <a href="http://www.etherstudy.net/static-nodes.json" target="new">파일링크</a></p>
				<p>CLI명령 admin.peers 입력 시 연결된 Peer들의 정보가 출력되는 지 확인하세요.</p>
				<img src="img/admin_peers.png" width="800px" border="1px"><br><br><br>
				<li>(Optional) Git 설치하기</li>
				<p>운영체제에 따라 Git을 설치하세요. <a href="https://git-scm.com/downloads" target="_blank">설치링크</a></p><br><br>
				<li>Dapp 환경설정</li>	
				<p>콘솔에 아래와 같이 입력하여 환경을 설정하세요.</p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>
								/$ node -v  <a href="https://nodejs.org/ko/download/" target="_blank">설치링크</a><br>
								/$ npm -v<br>
								/$ npm install express-generator -g</font><br>
								</p>
							        /$ git clone https://github.com/etherstudy/crowdfund.git <a href="https://github.com/etherstudy/crowdfund.git" target="_blank">Git소스링크</a><br>
								<font color=gray>
								/$ express crowdfund<br>
								/$ cd crowdfund;<br>
								/crowdfund $ npm install ethereum/web3.js --save<br>
								</font>
								</p>
							        /$ cd crowdfund;<br>
								/crowdfund$ npm install<br>
								/crowdfund$ npm start //구동시작<br>
							</code></p>
						</td>
					</tr>
				</table>
	                        <p>[TIP] nodemon으로 웹서버 재시작없이 이용하기</p>
				<p> /crowdfund $ npm install nodemon </p>
	                        <p> /crowdfund $ nodemon -x npm start </p>
	                        <br><br>
								
				<h3 class="step_final"> 완료 조건</h3>
	<p>브라우저로 <a href="http://127.0.0.1:3000" target="_blank">http://127.0.0.1:3000</a>에 접속하여 Express를 사용할 수 있는 지 확인하세요.</p>
				<br><br>
			</ol>
		</div>
	</div>

<!--Step 2-->
	<div class="steps">
		<h3 class="sub_title">Step 2. 크라우드 펀딩 시나리오</h3>
		<div class="content">
			<ol>
				<img src="img/Session4_step2.png" width="800px" border="1px">
			</ol>
		</div>
	</div>

<!--Step 3-->
	<div class="steps">
		<h3 class="sub_title">Step 3. Web3 / Contract연동</h3>
		<div class="content">
			<ol>
				<li>Web3 연동 </li>
				<p> <font color=blue>Dapp/eth.js</font> 파일에 아래와 같이 입력하여 Web3 모듈을 설치하고 Localhost에 Http로 연결하세요.</p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>var Web3 = require('web3');<br>
									var web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:8545"));</code></p>
						</td>
					</tr>
				</table><br><br>
				<li>Contract 연동</li>
				<p>ABI와 Contract Address로 Contract를 호출하세요.</p><br>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code>// crowdFund Contract<br>
								var walletTokenAbi = [<ABI 입력>];<br>
								var TokenContract = web3.eth.contract(walletTokenAbi).at(<TokenAddress 입력>);<br><br>
								// crowdFund Contract<br>
								var crowdFundAbi = [<ABI 입력>];<br>
								var CrowdFundContract = web3.eth.contract(crowdFundAbi).at(<CrowdFundAddress 입력>)</code></p>
						</td>
					</tr>
				</table><br><br>
			</ol>
		</div>
	</div>

<!--Step 4-->
	<div class="steps">
		<h3 class="sub_title">Step 4. Get / Set</h3>
		<div class="content">
			<ol>
				<li>Contract Get </li>
				<p><컨트랙트>.<함수명> 으로 컨트랙트의 Public 함수를 호출할 수 있습니다.</p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>// 토큰 장부 조회 (balanceOf)<br>
									&nbsp;exports.getTokenAmount = function (address) {<br>
								   &nbsp;&nbsp;return TokenContract.balanceOf(address);><br>
									&nbsp;};</code></p>
						</td>
					</tr>
				</table><br>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>// 펀딩 장부 조회 (balanceOf)<br>
									&nbsp;exports.getFundAmount = function (address) {<br>
								   &nbsp;&nbsp;return CrowdFundContract.balanceOf(address);><br>
									&nbsp;};</code></p>
						</td>
					</tr>
				</table><br><br>
					
					
					
				<li>Set(SendTransaction) <a href="https://web3js.readthedocs.io/en/1.0/web3-eth.html#sendtransaction
					" target="_blank"> 매뉴얼열기</a></li>
				<p></p>
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>// 이더 트랜잭션 수행<br>
										&nbsp;exports.sendTransaction =<br>  
										<br>
										  &nbsp;&nbsp;function(from,to,value,gas,callback) {<br>
										  <br>
										    &nbsp;&nbsp;&nbsp;web3.eth.sendTransaction({<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;to: to,<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;from: from,<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;value: web3.toWei(value,'ether'),<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;gas: 100000}, function (err, hash) {<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;if (err) {<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return callback(err, '');<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;} else {<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eturn callback(null, hash);<br>
										        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
										    &nbsp;&nbsp;&nbsp;});<br>
										&nbsp;};</code></p>
						</td>
					</tr>
				</table><br><br>
			        <li> 마이닝 실행을 실행하여 송금을 완료 (강사만 진행합니다.)  </li>
				<p></p>		
                                <table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td style="word-break: break-all">
							<p><code> miner.start()</code></p>
						</td>
					</tr>
				</table><br><br>
			</ol>
		</div>
	</div>

	<!--Step 5-->
	<div class="steps">
		<h3 class="sub_title">Step 5. Event watch</h3>
		<div class="content">
			<ol>
				<p>Contract에서 event 형으로 선언한 함수가 호출되면 EVM에서 Event가 발생합니다.</p>
				<p>event 형으로 선언한 함수는 전부 호출을 감지하여 이를 콜백처럼 활용할 수 있습니다.
				<table border="0px" width="800px" bgcolor="black" cellpadding="10pt"> 
					<tr>
						<td>
							<p><code>// 이벤트 모니터링<br>
									&nbsp;exports.fundTransferEvent = function( callback ) {<br>
									    &nbsp;&nbsp;CrowdFundContract.FundTransfer().watch(function(error, res){<br>
									        &nbsp;&nbsp;&nbsp;if (error) {<br>
									            &nbsp;&nbsp;&nbsp;&nbsp;return callback(err, '');<br>
									        &nbsp;&nbsp;&nbsp;} else {<br>
									            &nbsp;&nbsp;&nbsp;&nbsp;return callback(null, res);<br>
									        &nbsp;&nbsp;&nbsp;}<br>
									    &nbsp;&nbsp;});<br>
									&nbsp;};</code></p>
						</td>
					</tr>
				</table><br><br>
			</ol>
		</div>
	</div>
</body>
</html>
